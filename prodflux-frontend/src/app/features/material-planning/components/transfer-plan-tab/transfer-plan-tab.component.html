<div class="transfer-plan-container">
  @if (rows.length === 0) {
    <div class="empty-state">
      <p>Noch kein Plan berechnet.</p>
      <p class="hint">Erfassen Sie Produktionsziele und klicken Sie auf "Plan berechnen".</p>
    </div>
  } @else {
    <!-- Transfer ToDos Button -->
    @if (transfers.length > 0) {
      <div class="action-section">
        <button mat-raised-button color="accent" type="button" (click)="onAdoptTodos()">
          Transfer-ToDos übernehmen
        </button>
        <p class="action-hint">Übernimmt die Transfervorschläge in die ToDo-Liste</p>
      </div>
    }

    <app-material-table 
      [rows]="materialTableRows" 
      [columns]="allColumns"
      [showImage]="true"
      [showCategory]="true">
      <ng-template #customColumn let-row let-column="column">
        @if (column.key.startsWith('workshop-')) {
          @if (row.data.workshopData[+column.key.replace('workshop-', '')]; as wsData) {
            <div class="workshop-data">
              <div>Bedarf: {{ wsData.required | number:'1.0-2' }}</div>
              <div>Verfügbar: {{ wsData.availableAfter | number:'1.0-2' }}</div>
              <div [class.delta-positive]="wsData.delta >= 0"
                   [class.delta-negative]="wsData.delta < 0">
                Delta: {{ wsData.delta | number:'1.0-2' }}
              </div>
            </div>
          } @else {
            <span class="no-data">—</span>
          }
        } @else if (column.key === 'solution') {
          <div class="solution-content">
            @if (row.data.orderQty > 0) {
              <div class="order-suggestion">
                Bestellung: {{ row.data.orderQty | number:'1.0-2' }}
                @if (centralWorkshopId) {
                  <span class="central-info">(nach {{ getWorkshopName(centralWorkshopId) }})</span>
                }
              </div>
            }
            @if (row.data.transfers.length > 0) {
              <div class="transfer-suggestion">
                Transfer: {{ getTransferText(row.data.transfers) }}
              </div>
            }
            @if (row.data.orderQty === 0 && row.data.transfers.length === 0) {
              <span class="no-action">—</span>
            }
          </div>
        }
      </ng-template>
    </app-material-table>
  }
</div>
