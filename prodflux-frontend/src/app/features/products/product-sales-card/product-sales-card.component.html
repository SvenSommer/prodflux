<mat-card class="sales-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>point_of_sale</mat-icon>
      Verkäufe (sdlink.de)
    </mat-card-title>
    <div class="sales-summary" *ngIf="sales.length > 0">
      <span class="summary-badge">
        <mat-icon>shopping_cart</mat-icon>
        {{ getTotalQuantity() }} Stück in {{ sales.length }} Bestellungen
      </span>
    </div>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="sales.length > 0; else noSales">
      <!-- Pagination Info & Controls -->
      <div class="pagination-header" *ngIf="sales.length > pageSize">
        <span class="showing-info">
          Zeige {{ getStartIndex() + 1 }}–{{ getEndIndex() }} von {{ sales.length }}
        </span>
        <div class="pagination-controls">
          <button mat-icon-button
                  [disabled]="currentPage === 0"
                  (click)="previousPage()"
                  matTooltip="Vorherige Seite">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <span class="page-info">{{ currentPage + 1 }} / {{ getTotalPages() }}</span>
          <button mat-icon-button
                  [disabled]="currentPage >= getTotalPages() - 1"
                  (click)="nextPage()"
                  matTooltip="Nächste Seite">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>

      <table mat-table [dataSource]="getPaginatedSales()" class="sales-table">
        <!-- Order ID -->
        <ng-container matColumnDef="order_id">
          <th mat-header-cell *matHeaderCellDef>Bestellung</th>
          <td mat-cell *matCellDef="let sale">
            <a
              [href]="getOrderUrl(sale.order_id)"
              target="_blank"
              class="order-link"
              matTooltip="In sdlink.de öffnen">
              #{{ sale.order_id }}
              <mat-icon>open_in_new</mat-icon>
            </a>
          </td>
        </ng-container>

        <!-- Date -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Datum</th>
          <td mat-cell *matCellDef="let sale">{{ formatDate(sale.date_created) }}</td>
        </ng-container>

        <!-- Customer -->
        <ng-container matColumnDef="customer">
          <th mat-header-cell *matHeaderCellDef>Kunde</th>
          <td mat-cell *matCellDef="let sale">
            <div class="customer-info">
              <div class="customer-name-row">
                <span class="country-flag" *ngIf="sale.customer_country">{{ getCountryFlag(sale.customer_country) }}</span>
                <span class="customer-name">{{ sale.customer_name || 'Unbekannt' }}</span>
              </div>
              <span class="customer-location" *ngIf="sale.customer_city">
                {{ sale.customer_city }}
              </span>
            </div>
          </td>
        </ng-container>

        <!-- Quantity -->
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef class="text-center">Menge</th>
          <td mat-cell *matCellDef="let sale" class="text-center">
            <span class="quantity-badge">{{ sale.quantity }}</span>
          </td>
        </ng-container>

        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let sale">
            <mat-chip [class]="'status-chip status-' + sale.status">
              {{ getStatusLabel(sale.status) }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Bottom Pagination Controls -->
      <div class="pagination-footer" *ngIf="sales.length > pageSize">
        <mat-paginator
          [length]="sales.length"
          [pageSize]="pageSize"
          [pageIndex]="currentPage"
          [pageSizeOptions]="[5, 10, 25, 50]"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </div>

    <ng-template #noSales>
      <div class="no-sales">
        <mat-icon>shopping_cart_off</mat-icon>
        <h4>Keine Verkäufe gefunden</h4>
        <p>Dieses Produkt wurde noch nicht über sdlink.de verkauft.</p>
      </div>
    </ng-template>
  </mat-card-content>
</mat-card>
