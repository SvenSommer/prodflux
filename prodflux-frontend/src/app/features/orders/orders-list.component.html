<div class="page-container">
  <app-breadcrumb
    [links]="[{ label: 'Bestellungen', url: '/orders' }]"
  ></app-breadcrumb>

  <div class="orders-table-wrapper">
    <div class="header-row">
      <h2>Bestellungen</h2>
      <a routerLink="/orders/new">
        <button mat-raised-button color="primary">
          <mat-icon>add</mat-icon>
          Neue Bestellung
        </button>
      </a>
    </div>

    <table
      mat-table
      [dataSource]="orders"
      class="mat-elevation-z1 full-width-table clickable-table"
    >
      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let o">{{ o.id }}</td>
      </ng-container>

      <!-- Supplier -->
      <ng-container matColumnDef="supplier">
        <th mat-header-cell *matHeaderCellDef>Lieferant</th>
        <td mat-cell *matCellDef="let o">{{ getSupplierName(o.supplier) }}</td>
      </ng-container>

      <!-- Bestellt am -->
      <ng-container matColumnDef="bestellt_am">
        <th mat-header-cell *matHeaderCellDef>Bestellt am</th>
        <td mat-cell *matCellDef="let o">{{ formatDate(o.bestellt_am) }}</td>
      </ng-container>

      <!-- Angekommen am -->
      <ng-container matColumnDef="angekommen_am">
        <th mat-header-cell *matHeaderCellDef>Angekommen am</th>
        <td mat-cell *matCellDef="let o">{{ formatDate(o.angekommen_am) }}</td>
      </ng-container>

      <!-- Historisch -->
      <ng-container matColumnDef="is_historical">
        <th mat-header-cell *matHeaderCellDef>Historisch</th>
        <td mat-cell *matCellDef="let o">
          <mat-icon *ngIf="o.is_historical" class="historical-icon" title="Historische Bestellung - keine Auswirkung auf Materialbestand">
            history
          </mat-icon>
        </td>
      </ng-container>

      <!-- Notiz -->
      <ng-container matColumnDef="notiz">
        <th mat-header-cell *matHeaderCellDef>Notiz</th>
        <td mat-cell *matCellDef="let o">{{ o.notiz || "â€”" }}</td>
      </ng-container>

      <!-- Materialien -->
      <ng-container matColumnDef="materials">
        <th mat-header-cell *matHeaderCellDef>Materialien</th>
        <td mat-cell *matCellDef="let o">
          <div class="materials-list">
            {{ getMaterialsList(o.items) }}
          </div>
        </td>
      </ng-container>

      <!-- Gesamtkosten -->
      <ng-container matColumnDef="total_cost">
        <th mat-header-cell *matHeaderCellDef>Gesamtkosten</th>
        <td mat-cell *matCellDef="let o">
          <strong>{{ formatCurrency(calculateTotalCost(o)) }}</strong>
        </td>
      </ng-container>

      <!-- Versandkosten -->
      <ng-container matColumnDef="versandkosten">
        <th mat-header-cell *matHeaderCellDef>Versandkosten</th>
        <td mat-cell *matCellDef="let o">
          {{ formatCurrency(o.versandkosten) }}
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="[
          'id',
          'supplier',
          'bestellt_am',
          'angekommen_am',
          'is_historical',
          'materials',
          'total_cost',
          'notiz'
        ]"
      ></tr>
      <tr
        mat-row
        *matRowDef="
          let row;
          columns: [
            'id',
            'supplier',
            'bestellt_am',
            'angekommen_am',
            'is_historical',
            'materials',
            'total_cost',
            'notiz'
          ]
        "
        (click)="navigateToDetail(row.id)"
        class="clickable-row"
      ></tr>
    </table>
  </div>
</div>
